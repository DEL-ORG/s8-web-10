pipeline {
    agent any
    parameters {
        string(name: 'built_image_name', defaultValue: 's8victor', description: 'Name for your built image')
        string(name: 'image_name', defaultValue: 'httpd', description: 'Image you want to pull and build upon')
        text(name: 'additional_content', defaultValue: 'write your RUN "commands"', description: 'Additional content to include in the Dockerfile')
        string(name: 'container_name', defaultValue: 's8victor', description: 'name for your container to run on your built image')
    }
    stages {
        stage('Check servers and images') {
            steps {
                script { 
                    sh """
                    docker ps 
                    docker images
                    """
                }
            }
        }

        stage('Pull an image') {
            steps {
                script { 
                    sh """
                    docker pull ${params.image_name}
                   # docker run -itd --name ${params.server_name} ${params.image_name} bash
                    """
                }
            }
        }

        stage('Build a Dockerfile') {
            steps {
                script {
                    sh """
cat << EOF > Dockerfile
FROM ${params.image_name}

${params.additional_content}
EOF
                    """
                }
            }
        }

        stage('Build the image and start a container') {
            steps {
                script { 
                    sh """
                    docker build -t ${params.built_image_name} .
                    docker images 
                    docker run -itd --name ${params.container_name} ${params.built_image_name} bash
                    """
                }
            }
        }
    }
}
